{"version":3,"file":"lib_index_js.27e956b218ce621c2450.js","mappings":";;;;;;;;;;;;;;;;;;AAKwD;AAER;AACM;AAEtD;;GAEG;AACH,MAAM,UAAU,GAAG,IAAI,0DAAU,EAAE,CAAC;AACpC,MAAM,aAAa,GAAG,IAAI,gEAAa,EAAE,CAAC;AAE1C;;GAEG;AACH,MAAM,MAAM,GAAgC;IAC1C,EAAE,EAAE,0BAA0B;IAC9B,WAAW,EAAE,yBAAyB;IACtC,SAAS,EAAE,IAAI;IACf,QAAQ,EAAE,CAAC,kEAAgB,CAAC;IAC5B,QAAQ,EAAE,CAAC,GAAoB,EAAE,eAAiC,EAAE,EAAE;QACpE,OAAO,CAAC,GAAG,CAAC,yCAAyC,CAAC,CAAC;QACvD,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;QAEzB,OAAO,CAAC,GAAG,CAAC,sDAAsD,CAAC,CAAC;QACpE,aAAa,CAAC,QAAQ,CAAC,GAAG,EAAE;YAC1B,UAAU;YACV,eAAe;SAChB,CAAC,CAAC;IACL,CAAC;CACF,CAAC;AAEF,iEAAe,MAAM,EAAC;;;;;;;;;;;;;;;;;;ACpC8B;AACL;AACxC;AACP;AACA,mCAAmC,yDAAW;AAC9C;AACA;AACA,YAAY,8DAAW;AACvB;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;ACpBO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACO;AACP;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;;;;;;;;;;;;;;;;;;;;AC3BqC;AACU;AACS;AACjD;AACP;AACA,mCAAmC,yDAAW;AAC9C;AACA,YAAY,oDAAS;AACrB,mCAAmC,qEAAqB;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA,oBAAoB,IAAI;AACxB;AACA,6BAA6B,UAAU;AACvC;AACA,8BAA8B,iCAAiC;AAC/D;AACA;;;;;;;;;;;;;;;;ACvCkC;AACZ;;;;;;;;;;;;;;;;;;ACDiC;AACZ;AACpC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,YAAY;AACrC;AACA;AACA;AACA;AACA,mBAAmB,kEAAmB;AACtC;AACA;AACA;AACA;AACA,iBAAiB,qDAAO;AACxB,8DAA8D,IAAI;AAClE,wBAAwB,qDAAO;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;AChCyD;AACD;AACwB;AACxC;AACM;AAC/B;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,qDAAO;AAC5B;AACA;AACA;AACA,kCAAkC,yDAAW;AAC7C;AACA,gCAAgC,qEAAsB;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,qEAAqB;AAC9D,4BAA4B,qEAAsB;AAClD;AACA,wBAAwB,qDAAc;AACtC,qBAAqB,2DAAiB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://@anaconda/toolbox/./src/index.ts","webpack://@anaconda/toolbox/../../lib/core/lib/datadog.js","webpack://@anaconda/toolbox/../../lib/core/lib/feature_flag.js","webpack://@anaconda/toolbox/../../lib/core/lib/heap.js","webpack://@anaconda/toolbox/../../lib/core/lib/index.js","webpack://@anaconda/toolbox/../../lib/core/lib/launch_darkly.js","webpack://@anaconda/toolbox/../../lib/core/lib/plugin.js"],"sourcesContent":["import {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\n\nimport { INotebookTracker } from '@jupyterlab/notebook';\n\nimport { CorePlugin } from '@anaconda/core_lib';\nimport { ToolboxPlugin } from '@anaconda/toolbox_lib';\n\n/**\n * Initialization data for the @anaconda/extensions extension.\n */\nconst corePlugin = new CorePlugin();\nconst toolboxPlugin = new ToolboxPlugin();\n\n/**\n * Initialization data for the @anaconda/toolbox extension.\n */\nconst plugin: JupyterFrontEndPlugin<void> = {\n  id: '@anaconda/toolbox:plugin',\n  description: 'A JupyterLab extension.',\n  autoStart: true,\n  requires: [INotebookTracker],\n  activate: (app: JupyterFrontEnd, notebookTracker: INotebookTracker) => {\n    console.log('JupyterLab extension core is activated!');\n    corePlugin.activate(app);\n\n    console.log('JupyterLab extension @anaconda/toolbox is activated!');\n    toolboxPlugin.activate(app, {\n      corePlugin,\n      notebookTracker\n    });\n  }\n};\n\nexport default plugin;\n","import { datadogLogs } from \"@datadog/browser-logs\";\nimport { Environment } from \"@anaconda/shared\";\nexport function initializeDatadog(config, monorepoFeatureFlagEnabled) {\n    try {\n        if (config.environment === Environment.production &&\n            monorepoFeatureFlagEnabled) {\n            console.log(\"Initializing Datadog\");\n            datadogLogs.init({\n                clientToken: config.datadog.clientToken,\n                service: config.datadog.service,\n                forwardErrorsToLogs: true,\n                silentMultipleInit: true,\n            });\n            return true;\n        }\n    }\n    catch (e) {\n        console.log(\"failed to initialize datadog\");\n    }\n    return false;\n}\n","export function createCloudFeatureFlag(client, overrides) {\n    return {\n        getBool(name, fallback) {\n            const override = overrides[name];\n            return typeof override === \"boolean\"\n                ? override\n                : client.variation(name, fallback);\n        },\n        getString(name, fallback) {\n            const override = overrides[name];\n            return typeof override === \"string\"\n                ? override\n                : client.variation(name, fallback);\n        },\n    };\n}\nexport function createLocalFeatureFlag(overrides) {\n    return {\n        getBool(name, fallback) {\n            const override = overrides[name];\n            return typeof override === \"boolean\" ? override : fallback;\n        },\n        getString(name, fallback) {\n            const override = overrides[name];\n            return typeof override === \"string\" ? override : fallback;\n        },\n    };\n}\n","import ReactHeap from \"reactjs-heap\";\nimport { Environment } from \"@anaconda/shared\";\nimport { getLaunchDarklyClient } from \"./launch_darkly\";\nexport async function initializeHeap(config) {\n    try {\n        if (config.environment !== Environment.local) {\n            console.log(\"initializing heap\");\n            ReactHeap.initialize(config.heap.clientId);\n            const ldClient = await getLaunchDarklyClient(config);\n            addLaunchDarklyToHeap(ldClient);\n            return true;\n        }\n    }\n    catch (e) {\n        console.log(\"failed to initialize heap\");\n    }\n    return false;\n}\nexport function addLaunchDarklyToHeap(client) {\n    // There's no @types for heap's window object unfortunately\n    // Also unfortunately, ReactHeap doesn't return the variable, but instead we have to pull it\n    // off window instead\n    const heap = window.heap;\n    if (!heap)\n        return false;\n    console.log(\"initializing heap user and event properties\");\n    let ffUserID = client.getContext().key;\n    if (ffUserID !== \"user:unknown-user-id\") {\n        heap.identify(ffUserID.replace(\"user:\", \"\"));\n    }\n    // prepend ff- to the name of all the feature flags to make it easier to find in heap\n    const flags = { \"ff-initialized\": \"true\" };\n    for (const [key, value] of Object.entries(client.allFlags())) {\n        flags[`ff-${key}`] = value;\n    }\n    heap.addUserProperties({ ffUserID });\n    heap.clearEventProperties();\n    heap.addEventProperties({ ldInitialized: \"true\", ...flags });\n    return true;\n}\n","import CorePlugin from \"./plugin\";\nexport { CorePlugin };\n","import * as LDCLient from \"launchdarkly-js-client-sdk\";\nimport { backend } from \"@anaconda/shared\";\nexport async function getLaunchDarklyClient(config) {\n    let context;\n    try {\n        context = await getCloudContext();\n    }\n    catch (e) {\n        context = {\n            kind: \"user\",\n            key: `user:${getUserId()}`,\n            platform: config.platform,\n        };\n    }\n    console.log(\"initializing launch darkly\", context);\n    const client = LDCLient.initialize(config.featureFlag.clientId, context);\n    await client.waitUntilReady();\n    return client;\n}\nasync function getCloudContext() {\n    return await backend\n        .backendFetch(\"aext_core_server/feature_flag/init\", {}, {})\n        .then((data) => backend.handleProxyResponse(data));\n}\nfunction getUserId() {\n    let userId = \"unknown-user-id\";\n    const urlPathName = window.location.pathname;\n    const regExpMatch = urlPathName.match(/\\/user\\/([^/]*)\\//i);\n    if (regExpMatch && regExpMatch.length > 0) {\n        userId = regExpMatch[1];\n    }\n    return userId;\n}\n","import { backend, Environment, } from \"@anaconda/shared\";\nimport { getLaunchDarklyClient } from \"./launch_darkly\";\nimport { createCloudFeatureFlag, createLocalFeatureFlag } from \"./feature_flag\";\nimport { initializeHeap } from \"./heap\";\nimport { initializeDatadog } from \"./datadog\";\nexport default class Plugin {\n    #ready;\n    constructor() {\n        this.#ready = this._getReady();\n    }\n    activate(app, opts) { }\n    ready() {\n        return this.#ready;\n    }\n    async getConfig() {\n        return await backend.backendFetch(\"aext_core_server/config\");\n    }\n    async _getReady() {\n        const config = await this.getConfig();\n        if (config.environment == Environment.local) {\n            console.log(\"[Config] local config\");\n            const featureFlag = createLocalFeatureFlag(config.featureFlag.overrides);\n            const analytics = {\n                heap: false,\n                datadog: false,\n            };\n            return {\n                featureFlag,\n                analytics,\n                config,\n            };\n        }\n        console.log(\"[Config] cloud config\");\n        const launchDarklyClient = await getLaunchDarklyClient(config);\n        const featureFlag = createCloudFeatureFlag(launchDarklyClient, config.featureFlag.overrides);\n        const analytics = {\n            heap: await initializeHeap(config),\n            datadog: initializeDatadog(config, featureFlag.getBool(\"monorepo-datadog\", false)),\n        };\n        return {\n            featureFlag,\n            analytics,\n            config,\n        };\n    }\n}\n"],"names":[],"sourceRoot":""}